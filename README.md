# svd2nim

Convert [ARM CMSIS-SVD](https://arm-software.github.io/CMSIS_5/SVD/html/index.html) files to nim register memory mappings.

This projects generates a Nim module file which can be imported to provide
access to microcontroller register peripherals. The generated Nim module
therefore serves the same purpose as CMSIS
[device.h](https://www.keil.com/pack/doc/CMSIS/Core/html/device_h_pg.html#device_h_sec)
files as generated by `SVDCONV` or provided by silicon manufacturers.

## Building

Install Nim and Nimble: see https://nim-lang.org/install.html. Then,

```bash
git clone https://github.com/auxym/svd2nim
cd svd2nim
nimble install
nimble build
```

The svd2nim binary will be produced in the `./build` subdirectory.

## Usage

...

## Status

svd2nim is considered to be **experimental** status. Feel free to try it, but be
warned that it could generate entire incorrect code, including code that sets
your microcontroller on fire.

## Limitations

The following CMSIS-SVD features are not implemented. Warnings will be produced
if they are encountered.  However, searching through a large repository of SVD
files (https://github.com/posborne/cmsis-svd) leads me to believe that these
features are never, or very rarely, used in the wild.

* `<field>` and `<enumeratedValues>` elements that are `derivedFrom`

* `<field>` elements containing `<dim>`, used to generate arrays or lists
  of similar elements. Note: `dim` registers, clusters and peripherals are
  commonly used and supported (except for below).

* `dim` arrays of peripherals. That is, `<peripheral>` elements with
   names containing `[%s]`. `dim` lists of peripherals, using plain `%s`,
   are supported.

## API

The Nim module generated by svd2nim tries to stay close to CMSIS conventions
when it makes sense to do so. However, Nim does not map 1:1 to C (in particular,
for marking struct members `volatile` or `const`, and for anonymous unions),
therefore the API is not identical to CMSIS C `device.h` headers. The API has
two main goals:

1. As close as possible to zero performance cost for accessing registers,
   compared to using C headers directly.

2. Use Nim's type system to provide as much safety as possible while still
   respecting goal #1.

The examples below are taken from the Nim module generated from the `ATSAMD21G18A.svd`
found under the `tests` folder of the repository.

### Peripheral objects

...

### Accessors

...